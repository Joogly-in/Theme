<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Matrix Birthday â€“ Pastel Spiral</title>

<style>
  :root{
    --card-bg: rgba(255,255,255,0.72);
    --panel-radius: 18px;
    --shadow: 0 10px 30px rgba(0,0,0,0.08);
    --pastel-1: #ffd6e7;
    --pastel-2: #e6f7ff;
    --pastel-3: #fff2d6;
    --pastel-4: #eaf8e6;
    --pastel-5: #f0e7ff;
    --ui-font: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Color Emoji";
  }

  html,body{
    height:100%;
    margin:0;
    overflow:hidden;
    font-family: var(--ui-font);
    -webkit-font-smoothing:antialiased;
    background: linear-gradient(135deg, var(--pastel-1) 0%, var(--pastel-2) 30%, var(--pastel-5) 60%, var(--pastel-3) 100%);
  }

  canvas{ display:block; width:100vw; height:100vh; }

  .center-panel{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.82));
    color:#444;
    padding:18px 28px;
    border-radius:var(--panel-radius);
    text-align:center;
    z-index:30;
    box-shadow:var(--shadow);
    min-width:300px;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.6);
  }
  .center-panel h1{ margin:0; font-size:clamp(20px,4vw,40px); font-weight:800; color:#2c2c2c; }
  .center-panel p{ margin:8px 0 0 0; font-size:14px; opacity:0.9; }
  .subtitle-wish{ margin-top:10px; font-size:13px; color:#666; }
  .hint{ font-size:12px; margin-top:10px; opacity:0.85; }

  @media (max-width:420px){
    .center-panel{ padding:14px 18px; min-width:240px; }
    .center-panel h1{ font-size:20px; }
  }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="center-panel" id="centerPanel" aria-live="polite">
  <h1 id="title">Happy Birthday</h1>
  <p id="subtitle">Make a wish âœ¨</p>
  <div class="subtitle-wish hint">Click to pause/play â€¢ URL params: <code>?message=...&name=...&date=...</code></div>
</div>

<script>
/* ---------------- URL PARAMS ---------------- */
function getParam(k,d=""){ try{return decodeURIComponent(new URL(location.href).searchParams.get(k)||d);}catch(_){return d;} }

const msgParam  = getParam("message","Happy Birthday");
const nameParam = getParam("name","");
const dateParam = getParam("date","");

const titleEl = document.getElementById("title");
const subtitleEl = document.getElementById("subtitle");

titleEl.textContent = msgParam + (nameParam ? " " + nameParam : "");

if(dateParam){
  const dt = new Date(dateParam);
  subtitleEl.textContent = isNaN(dt) ? dateParam : dt.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
}

/* ---------------- CANVAS SETUP ---------------- */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = true;

let W = innerWidth, H = innerHeight;
let DPR = Math.max(1, devicePixelRatio || 1);
let cx = W/2, cy = H/2;

function resize(){
  W = innerWidth; H = innerHeight;
  DPR = Math.max(1, devicePixelRatio || 1);
  cx = Math.round(W/2); cy = Math.round(H/2);
  canvas.width = Math.round(W * DPR);
  canvas.height = Math.round(H * DPR);
  canvas.style.width = W + "px";
  canvas.style.height = H + "px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener("resize", resize);

/* ---------------- CONFIG ---------------- */
const cfg = {
  baseFont: 26,
  lineHeight: 34,
  spiralGap: 20,        // spacing along spiral (radius step per char)
  spawnInterval: 0.28,  // time between new streams (per pool)
  maxStreams: 22,       // total concurrent streams
  trailAlpha: 0.14,
  glowBlur: 10,
  charAlpha: 0.98
};

const pastelColors = [
  "rgba(255,166,196,0.98)",
  "rgba(200,235,255,0.98)",
  "rgba(240,230,255,0.98)",
  "rgba(255,245,220,0.98)",
  "rgba(218,255,236,0.98)"
];

const emojis = ["ðŸŽ‰","ðŸŽ‚","ðŸŽˆ","ðŸŽ","ðŸ’–","ðŸ˜Š","âœ¨","ðŸ¥³","ðŸŒ¸","ðŸ°"];

const words = [
  (msgParam || "HAPPY").toUpperCase(),
  "",
  "BIRTHDAY",
  "",
  (nameParam || "").toUpperCase().replace(/\s+/g,"")
].filter((w,i)=> !(w==="" && i===0));

/* ---------------- STREAM POOL ---------------- */
let streams = [];

function rand(a,b){ return a + Math.random()*(b-a); }

/* Create a spiral stream starting near center */
function createSpiralStream(){
  // Build char array from words with small spacers
  const chars = [];
  for(const w of words){
    if(w===""){ chars.push(""); }
    else for(const ch of w) chars.push(ch);
    chars.push("");
    if(Math.random() < 0.22) chars.push("");
  }
  // sprinkle some emojis
  if(Math.random() < 0.16){
    const n = 1 + Math.floor(Math.random()*3);
    for(let k=0;k<n;k++){
      const pos = Math.floor(Math.random()*chars.length);
      chars[pos] = emojis[Math.floor(Math.random()*emojis.length)];
    }
  }

  // polar parameters
  const startRadius = rand(4, 28) * (Math.random() < 0.4 ? -1 : 1); // allow tiny offset +/-; negative to start inside center sometimes
  const radialSpeed = rand(28, 110); // px per second outward
  const angle = rand(0, Math.PI*2);
  // angular speed produces rotation while spiraling (can be clockwise or ccw)
  const angularSpeed = rand(-1.6, 1.6) * 0.6; // radians per second (subtle)
  // stretch factor controls how tight the spiral (how radius increases with angle),
  // we'll primarily use radialSpeed and per-character spacing
  return {
    chars,
    r: startRadius,
    radialSpeed,
    angle,
    angularSpeed,
    birth: performance.now(),
    lifeLimit: rand(6.5, 13) // seconds to live (safety)
  };
}

/* ---------------- DRAW A STREAM (polar -> cartesian) ---------------- */
function drawSpiralStream(S){
  const lh = cfg.lineHeight;
  // set soft glow
  ctx.shadowBlur = cfg.glowBlur;
  ctx.shadowColor = "rgba(255,255,255,0.16)";
  ctx.textBaseline = "top";

  for(let i=0;i<S.chars.length;i++){
    const ch = S.chars[i];
    if(!ch) continue;

    // radius for this character = stream.r + i * spiralGap
    const r_i = S.r + i * (cfg.spiralGap * 0.88); // slight compression so chars are closer
    const theta_i = S.angle + i * 0.065; // small angular offset so chars follow a spiral curve

    // convert polar to cartesian around canvas center
    const x = Math.round(cx + r_i * Math.cos(theta_i));
    const y = Math.round(cy + r_i * Math.sin(theta_i));

    // skip if outside canvas bounds (small margin)
    if(x < -50 || x > W + 50 || y < -50 || y > H + 50) continue;

    // font and color
    if(emojis.includes(ch)){
      ctx.font = `${Math.round(cfg.baseFont * 1.28)}px 'Segoe UI Emoji','Apple Color Emoji','Noto Color Emoji'`;
    } else {
      ctx.font = `${cfg.baseFont}px 'Segoe UI','Segoe UI Symbol', system-ui`;
    }
    // choose pastel color with slight deterministic variation
    const color = pastelColors[(i + Math.floor((S.angle*100)|0)) % pastelColors.length];
    ctx.globalAlpha = cfg.charAlpha;
    // playful horizontal jitter using small function of r and angle
    const jitter = Math.sin((r_i + theta_i*40) * 0.03) * 1.6;
    ctx.fillStyle = color;
    ctx.fillText(ch, x + jitter, y);
  }

  // reset shadow for next draws
  ctx.shadowBlur = 0;
  ctx.shadowColor = "transparent";
}

/* ---------------- ANIMATION LOOP ---------------- */
let last = performance.now();
let paused = false;
let spawnTimer = 0;

function tick(now){
  const dt = Math.min(0.05, (now - last)/1000);
  last = now;

  if(!paused){
    // soft pastel fade to leave gentle trails
    ctx.fillStyle = `rgba(255,255,255,${cfg.trailAlpha})`;
    ctx.fillRect(0,0,W,H);

    // spawn new streams until pool size reached
    spawnTimer += dt;
    while(spawnTimer >= cfg.spawnInterval && streams.length < cfg.maxStreams){
      streams.push(createSpiralStream());
      spawnTimer -= cfg.spawnInterval;
    }

    // update and draw each stream
    for(let i = streams.length - 1; i >= 0; i--){
      const s = streams[i];
      // advance radial distance and angle
      s.r += s.radialSpeed * dt;       // move outward
      s.angle += s.angularSpeed * dt;  // rotate while moving

      // draw characters along spiral
      drawSpiralStream(s);

      // lifetime and bounds check to remove old streams
      const age = (now - s.birth)/1000;
      // if radius is huge (off-screen) or lived past lifeLimit, remove
      if(s.r > Math.max(W,H) * 1.5 || age > s.lifeLimit){
        streams.splice(i,1);
      }
    }
  }

  requestAnimationFrame(tick);
}

/* ---------------- INTERACTION ---------------- */
window.addEventListener("click", ()=>{
  paused = !paused;
  const hint = document.querySelector(".hint");
  hint.textContent = paused ? "Paused â€¢ click to resume" : "Click to pause/play â€¢ URL params: ?message=...&name=...&date=...";
});

/* ---------------- START ---------------- */
resize();
ctx.fillStyle = "rgba(255,255,255,0.02)";
ctx.fillRect(0,0,W,H);
requestAnimationFrame(tick);
</script>

</body>
</html>
